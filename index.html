<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <title>Logiqa Supply</title>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <div id="loader" class="hidden">
    <div class="spinner"></div>
  </div>

  <!-- 1. DASHBOARD (–ì–õ–ê–í–ù–ê–Ø) -->
  <div id="view-dashboard" class="screen">
    <div class="dash-header">
      <div class="dash-title">
        <h1>Logiqa Projects</h1>
      </div>
      <div style="display:flex; gap:10px;">
        <button class="btn btn-text" onclick="app.openArchive()">üì¶ –ê—Ä—Ö–∏–≤</button>
        <button class="btn btn-text" onclick="app.openSuppliersEdit()">üë• –ü–æ—Å—Ç–∞–≤—â–∏–∫–∏</button>
        <button class="btn btn-primary" onclick="app.newProject()"><i class="fas fa-plus"></i> –ü—Ä–æ–µ–∫—Ç</button>
      </div>
    </div>

    <div class="kanban-board">
      <div class="k-col" id="col-new" ondragover="app.allowDrop(event)" ondrop="app.drop(event, 'new')">
        <div class="k-head h-new">üìù –§–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è</div>
        <div class="k-list" id="list-new"></div>
      </div>
      <div class="k-col" id="col-active" ondragover="app.allowDrop(event)" ondrop="app.drop(event, 'active')">
        <div class="k-head h-active">üõí –ó–∞–∫—É–ø</div>
        <div class="k-list" id="list-active"></div>
      </div>
      <div class="k-col" id="col-done" ondragover="app.allowDrop(event)" ondrop="app.drop(event, 'done')">
        <div class="k-head h-done">‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω</div>
        <div class="k-list" id="list-done"></div>
      </div>
    </div>
  </div>

  <!-- 2. ARCHIVE (–ê–†–•–ò–í) -->
  <div id="view-archive" class="screen hidden">
    <div class="dash-header">
      <div class="dash-title">
        <button class="btn btn-text" onclick="app.goHome()"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</button>
        <span style="font-size:20px; font-weight:bold; margin-left:10px;">üì¶ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–∫—É–ø—ã</span>
      </div>
    </div>
    <div class="project-grid" id="archiveList" style="padding:20px;"></div>
  </div>

  <!-- 3. MANAGER (–ú–ï–ù–ï–î–ñ–ï–†) -->
  <div id="view-manager" class="screen hidden">
    <div class="dash-header" style="padding: 10px 20px;">
      <button class="btn btn-text" onclick="app.goHome()"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</button>
      <input type="text" id="mgrName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞" class="header-input">
      <button class="btn btn-primary" onclick="manager.save()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
    <div class="mgr-toolbar">
      <input type="file" id="xlsInput" hidden>
      <button class="btn btn-def" onclick="document.getElementById('xlsInput').click()">üìÇ –ò–º–ø–æ—Ä—Ç</button>
      <button class="btn btn-def" onclick="manager.addRow()">‚ûï –°—Ç—Ä.</button>
      <div class="sep"></div>
      <button class="btn btn-p" onclick="manager.sort()">üîÉ –°–æ—Ä—Ç.</button>
      <button class="btn btn-w" onclick="manager.openMerge()">üîó –û–±—ä–µ–¥.</button>
      <button class="btn btn-p" onclick="manager.openSup()">üöö –ü–æ—Å—Ç.</button>
      <button class="btn btn-d" onclick="manager.delSel()">üóëÔ∏è</button>
      <div style="flex:1"></div>
      <input type="text" id="mgrSearch" placeholder="üîç..." oninput="manager.render()"
        style="width:100px; padding:5px;">
      <span id="mgrTotal" style="font-weight:bold; color:#666; margin-left:10px;">0</span>
    </div>
    <div class="mgr-grid">
      <table id="mgrTable">
        <thead>
          <tr>
            <th class="chk"><input type="checkbox" id="mgrAll" onchange="manager.toggleAll(this.checked)"></th>
            <th>–ê—Ä—Ç–∏–∫—É–ª</th>
            <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
            <th>–ö–æ–ª-–≤–æ</th>
            <th>–ï–¥.</th>
            <th>–¶–µ–Ω–∞</th>
            <th>–°—É–º–º–∞</th>
            <th>–ü–æ—Å—Ç–∞–≤—â–∏–∫</th>
            <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</th>
          </tr>
        </thead>
        <tbody id="mgrBody"></tbody>
      </table>
    </div>
  </div>

  <!-- 4. BUYER (–°–ù–ê–ë–ñ–ï–ù–ï–¶ - –í–ï–†–ù–£–õ–ò –ï–ì–û –ù–ê –ú–ï–°–¢–û) -->
  <div id="view-buyer" class="screen hidden">
    <div class="buy-header">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <button class="btn" style="color:white; padding:0;" onclick="app.goHome()"><i
            class="fas fa-arrow-left"></i></button>
        <span
          style="font-weight:bold; font-size:16px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; max-width:150px;"
          id="buyTitle">–ü—Ä–æ–µ–∫—Ç</span>
        <div style="width:20px"></div>
      </div>
      <div class="buy-filters">
        <select id="buySupFilter" onchange="buyer.render()">
          <option value="ALL">–í—Å–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∏</option>
        </select>
      </div>
      <div class="buy-progress">
        <div class="buy-bar" id="buyBar"></div>
      </div>
    </div>
    <div class="buy-list" id="buyList"></div>
    <div class="footer"><span>–§–∞–∫—Ç:</span><span id="buyTotal" style="color:var(--primary)">0 ‚Ç∏</span></div>
  </div>

  <!-- === –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê (–¢–ï–ü–ï–†–¨ –û–ù–ò –°–ù–ê–†–£–ñ–ò, –≠–¢–û –í–ê–ñ–ù–û) === -->

  <!-- –ò–º–ø–æ—Ä—Ç -->
  <div id="modal" class="hidden">
    <div class="dash-header">
      <h2>–ò–º–ø–æ—Ä—Ç</h2>
      <div>
        <button class="btn btn-text" onclick="document.getElementById('modal').classList.add('hidden')">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn btn-primary" onclick="mapper.apply()">–û–ö</button>
      </div>
    </div>
    <div style="flex:1; overflow:auto; padding:20px;">
      <table id="mapTable"></table>
    </div>
  </div>

  <!-- –†–µ–¥–∞–∫—Ç–æ—Ä –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ -->
  <div id="supEditModal" class="modal-overlay hidden">
    <div class="modal-box" style="width:600px; max-width:95%;">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
        <h3>üë• –ë–∞–∑–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤</h3>
        <button class="btn btn-primary" onclick="app.addSupplierRow()">+ –î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
      <div style="max-height:400px; overflow:auto;">
        <table style="width:100%;">
          <thead>
            <tr>
              <th>–ò–º—è</th>
              <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="supEditBody"></tbody>
        </table>
      </div>
      <div style="text-align:right; margin-top:20px;">
        <button class="btn btn-text"
          onclick="document.getElementById('supEditModal').classList.add('hidden')">–ó–∞–∫—Ä—ã—Ç—å</button>
        <button class="btn btn-p" onclick="app.saveSuppliers()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
      </div>
    </div>
  </div>

  <!-- –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ -->
  <div id="mergeModal" class="modal-overlay hidden">
    <div class="modal-box">
      <h3>–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ</h3>
      <div id="mergeList" style="max-height:300px; overflow:auto;"></div>
      <div style="text-align:right; margin-top:10px;">
        <button class="btn btn-text"
          onclick="document.getElementById('mergeModal').classList.add('hidden')">–û—Ç–º.</button>
        <button class="btn btn-w" onclick="manager.applyMerge()">–û–ö</button>
      </div>
    </div>
  </div>

  <!-- –í—ã–±–æ—Ä –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ -->
  <div id="supModal" class="modal-overlay hidden">
    <div class="modal-box">
      <h3>–ü–æ—Å—Ç–∞–≤—â–∏–∫</h3>
      <select id="supSelect" style="width:100%; padding:10px; margin:10px 0; border:1px solid #ccc;"></select>
      <div style="text-align:right;">
        <button class="btn btn-text" onclick="document.getElementById('supModal').classList.add('hidden')">–û—Ç–º.</button>
        <button class="btn btn-p" onclick="manager.applySup()">–û–ö</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>

</html>